<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Luminara | Find Your Glow, Define Your Style ✨</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Load Inter Font -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;900&display=swap" rel="stylesheet">
    <style>
        /* Define custom colors and font for Tailwind */
        :root {
            --color-primary: #F9E8FF; /* Pastel Lavender Pink */
            --color-secondary: #C9A8FF; /* Lilac Purple */
            --color-text: #1a1a1a;
        }
        .text-primary { color: var(--color-primary); }
        .bg-primary { background-color: var(--color-primary); }
        .text-secondary { color: var(--color-secondary); }
        .bg-secondary { background-color: var(--color-secondary); }
        .gradient-bg {
            background: linear-gradient(135deg, var(--color-primary) 0%, var(--color-secondary) 100%);
        }
        body {
            font-family: 'Inter', sans-serif;
            color: var(--color-text);
            background-color: #f7f7f7;
        }
        .glow-shadow {
            box-shadow: 0 10px 30px -5px rgba(201, 168, 255, 0.5), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }
    </style>
</head>
<body class="min-h-screen antialiased">

    <!-- Global Variables for Firebase & API - REQUIRED for Canvas -->
    <script>
        const apiKey = "";
        // Function to convert base64 to ArrayBuffer for audio
        const base64ToArrayBuffer = (base64) => {
            const binaryString = atob(base64);
            const len = binaryString.length;
            const bytes = new Uint8Array(len);
            for (let i = 0; i < len; i++) {
                bytes[i] = binaryString.charCodeAt(i);
            }
            return bytes.buffer;
        };

        // Function to convert PCM to WAV (signed 16-bit, mono)
        const pcmToWav = (pcm16, sampleRate = 24000) => {
            const numChannels = 1;
            const bytesPerSample = 2; // 16-bit audio
            const byteRate = sampleRate * numChannels * bytesPerSample;
            const blockAlign = numChannels * bytesPerSample;
            const dataSize = pcm16.length * bytesPerSample;
            const buffer = new ArrayBuffer(44 + dataSize);
            const view = new DataView(buffer);

            let offset = 0;
            // RIFF chunk
            writeString(view, offset, 'RIFF'); offset += 4;
            view.setUint32(offset, 36 + dataSize, true); offset += 4;
            writeString(view, offset, 'WAVE'); offset += 4;
            // FMT chunk
            writeString(view, offset, 'fmt '); offset += 4;
            view.setUint32(offset, 16, true); offset += 4; // Sub-chunk size
            view.setUint16(offset, 1, true); offset += 2; // Audio format (1 = PCM)
            view.setUint16(offset, numChannels, true); offset += 2; // Channels
            view.setUint32(offset, sampleRate, true); offset += 4; // Sample rate
            view.setUint32(offset, byteRate, true); offset += 4; // Byte rate
            view.setUint16(offset, blockAlign, true); offset += 2; // Block align
            view.setUint16(offset, bytesPerSample * 8, true); offset += 2; // Bits per sample
            // DATA chunk
            writeString(view, offset, 'data'); offset += 4;
            view.setUint32(offset, dataSize, true); offset += 4;

            // Write PCM data
            for (let i = 0; i < pcm16.length; i++) {
                view.setInt16(offset, pcm16[i], true);
                offset += bytesPerSample;
            }

            return new Blob([view], { type: 'audio/wav' });
        };

        const writeString = (view, offset, string) => {
            for (let i = 0; i < string.length; i++) {
                view.setUint8(offset + i, string.charCodeAt(i));
            }
        };

    </script>

    <!-- Navigation -->
    <header class="sticky top-0 z-50 bg-white/90 backdrop-blur-md shadow-sm">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4 flex justify-between items-center">
            <h1 class="text-3xl font-black text-secondary uppercase tracking-widest">
                Luminara<span class="text-black">.ai</span>
            </h1>
            <nav class="hidden md:flex space-x-8 text-sm font-semibold">
                <a href="#how-it-works" class="hover:text-secondary transition duration-150">How It Works</a>
                <a href="#glow-tips" class="hover:text-secondary transition duration-150">Glow Tips</a>
                <button onclick="document.getElementById('analysis-modal').classList.remove('hidden')" class="bg-secondary text-white px-4 py-2 rounded-full font-bold hover:bg-opacity-90 transition duration-150 glow-shadow">
                    Start Analysis ✨
                </button>
            </nav>
            <button class="md:hidden text-2xl">
                <!-- Lucide Menu Icon (Simplified for single file) -->
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"><line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line></svg>
            </button>
        </div>
    </header>

    <main>
        <!-- Hero Section -->
        <section id="hero" class="gradient-bg py-24 sm:py-32 text-center overflow-hidden">
            <div class="max-w-4xl mx-auto px-4">
                <p class="text-black text-lg sm:text-xl font-semibold mb-4 tracking-wider">
                    Where AI Meets Your True Color
                </p>
                <h2 class="text-5xl sm:text-7xl font-extrabold text-black leading-tight mb-8">
                    Discover Your True <span class="text-white bg-black px-2 py-1 rounded-xl">Glow</span> with AI
                </h2>
                <p class="text-black text-xl sm:text-2xl mb-12 font-medium max-w-2xl mx-auto">
                    Find Your Glow, Define Your Style ✨. Analyze your undertone, unlock perfect color palettes, and get personalized skincare tips.
                </p>
                <button onclick="document.getElementById('analysis-modal').classList.remove('hidden')" class="bg-black text-white px-8 py-4 rounded-full text-lg font-extrabold hover:bg-opacity-80 transition duration-300 transform hover:scale-105 glow-shadow">
                    Start Instant Analysis
                    <!-- Camera Icon SVG -->
                    <svg class="inline-block w-6 h-6 ml-2 -mt-1" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z"></path><circle cx="12" cy="13" r="4"></circle></svg>
                </button>
            </div>
        </section>

        <!-- How It Works Section -->
        <section id="how-it-works" class="py-20 sm:py-24 bg-white">
            <div class="max-w-7xl mx-auto px-4">
                <h3 class="text-4xl font-bold text-center mb-16">
                    How It Works
                </h3>
                <div class="grid md:grid-cols-3 gap-12 text-center">
                    <div class="p-6 rounded-xl glow-shadow transition duration-300 hover:scale-[1.02] border border-gray-100">
                        <span class="text-5xl font-black text-secondary">01</span>
                        <h4 class="text-2xl font-bold my-4">Capture</h4>
                        <p class="text-gray-600">Upload a photo or use your camera for an accurate, unfiltered skin analysis.</p>
                    </div>
                    <div class="p-6 rounded-xl glow-shadow transition duration-300 hover:scale-[1.02] border border-gray-100">
                        <span class="text-5xl font-black text-secondary">02</span>
                        <h4 class="text-2xl font-bold my-4">Analyze</h4>
                        <p class="text-gray-600">Luminara AI instantly detects your precise skin tone and undertone (warm, cool, or neutral).</p>
                    </div>
                    <div class="p-6 rounded-xl glow-shadow transition duration-300 hover:scale-[1.02] border border-gray-100">
                        <span class="text-5xl font-black text-secondary">03</span>
                        <h4 class="text-2xl font-bold my-4">Glow</h4>
                        <p class="text-gray-600">Receive personalized style, makeup, skincare, and diet recommendations. Shine on!</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- Dynamic Results Section (Initially Hidden) -->
        <section id="results-container" class="py-20 sm:py-24 bg-primary hidden">
            <div class="max-w-6xl mx-auto px-4">
                <h3 class="text-4xl font-extrabold text-center mb-4">
                    Your Personalized Luminara Glow Report
                </h3>
                <p class="text-center text-lg font-medium text-gray-700 mb-12">
                    Shine in Your Own Tone — Here's the deep dive into your unique color profile.
                </p>

                <!-- Personal Skin Tone Analysis -->
                <div class="bg-white p-8 rounded-2xl glow-shadow mb-12">
                    <h4 class="text-3xl font-bold text-secondary mb-6">
                        Personal Skin Tone Analysis
                    </h4>
                    <div class="md:flex md:space-x-8">
                        <div class="md:w-1/2">
                            <p class="text-lg font-semibold mb-2">Your Undertone: <span id="r-undertone" class="text-black font-extrabold"></span></p>
                            <p id="r-undertone-desc" class="text-gray-600 mb-4"></p>
                            <p class="text-lg font-semibold mb-2">Characteristics:</p>
                            <p id="r-characteristics" class="text-gray-600 mb-4 border-l-4 border-secondary pl-3 italic"></p>
                        </div>
                        <div class="md:w-1/2">
                            <p class="text-lg font-semibold mb-3">Color Visualization:</p>
                            <div id="r-color-palette" class="flex h-16 rounded-lg overflow-hidden glow-shadow">
                                <!-- Colors dynamically inserted here -->
                            </div>
                            <p class="text-xs text-gray-400 mt-2">These shades enhance your natural glow, Sis. 💅</p>
                        </div>
                    </div>
                </div>

                <!-- Fashion & Outfit Recommendation -->
                <div class="bg-white p-8 rounded-2xl glow-shadow mb-12">
                    <h4 class="text-3xl font-bold text-secondary mb-6">
                        Fashion & Outfit Recommendation
                    </h4>
                    <p id="r-outfit-suggestion" class="text-lg font-medium mb-6"></p>

                    <p class="text-xl font-bold mb-4">Color Palette & Style Match:</p>
                    <div id="r-style-palette" class="flex flex-wrap gap-4 mb-8">
                         <!-- Style colors dynamically inserted here -->
                    </div>

                    <!-- Mock Product Card -->
                    <div class="p-6 border border-gray-100 rounded-xl bg-gray-50 flex flex-col sm:flex-row items-center gap-6">
                        <img src="https://placehold.co/120x160/C9A8FF/ffffff?text=Outfit+Mock" onerror="this.src='https://placehold.co/120x160/C9A8FF/ffffff?text=Outfit+Mock';" alt="Outfit Mockup" class="w-24 h-32 object-cover rounded-lg shadow-md flex-shrink-0">
                        <div>
                            <p class="text-xl font-bold mb-2">The Perfect 'Fit: <span class="text-secondary">AI Pick</span></p>
                            <p class="text-sm text-gray-600 mb-3">Try pairing <span id="r-try-on-text" class="font-semibold italic">a creamy lavender mini-dress</span> with minimalist gold accessories. It’s giving main character energy.</p>
                            <a id="r-try-on-link" href="#" target="_blank" class="text-sm font-semibold text-black bg-secondary/50 px-4 py-2 rounded-full inline-block hover:bg-secondary transition duration-150">
                                Try-On Preview / Shop Link →
                            </a>
                        </div>
                    </div>
                </div>

                <!-- Skincare, Diet & Lifestyle -->
                <div class="grid md:grid-cols-2 gap-8">
                    <div class="bg-white p-8 rounded-2xl glow-shadow">
                        <h4 class="text-3xl font-bold text-secondary mb-6">
                            Skin Care & Maintenance Tips
                        </h4>
                        <p class="text-lg font-semibold mb-2">Daily Glow Tips:</p>
                        <ul id="r-skincare-tips" class="list-disc list-inside space-y-2 text-gray-700 pl-4 mb-6">
                            <!-- Tips dynamically inserted here -->
                        </ul>
                        <p class="font-bold">Routine Suggestions:</p>
                        <p class="text-sm"><span class="font-semibold text-secondary">AM:</span> <span id="r-routine-morning"></span></p>
                        <p class="text-sm"><span class="font-semibold text-secondary">PM:</span> <span id="r-routine-night"></span></p>
                    </div>

                    <div class="bg-white p-8 rounded-2xl glow-shadow">
                        <h4 class="text-3xl font-bold text-secondary mb-6">
                            Diet & Lifestyle Recommendation
                        </h4>
                        <p class="text-lg font-semibold mb-2">Avoid These Vibes:</p>
                        <ul id="r-avoid-foods" class="list-disc list-inside space-y-2 text-gray-700 pl-4 mb-6">
                            <!-- Avoid foods dynamically inserted here -->
                        </ul>
                        <p class="text-lg font-semibold mb-2">Beneficial Superfoods:</p>
                        <ul id="r-beneficial-foods" class="list-disc list-inside space-y-2 text-gray-700 pl-4 mb-6">
                            <!-- Beneficial foods dynamically inserted here -->
                        </ul>
                        <p class="text-lg font-semibold mb-2">Hydration & Sleep:</p>
                        <p id="r-lifestyle-tips" class="text-gray-700"></p>
                    </div>
                </div>

                <div class="text-center mt-12">
                    <button onclick="document.getElementById('analysis-modal').classList.remove('hidden')" class="bg-black text-white px-6 py-3 rounded-full font-bold hover:bg-opacity-80 transition duration-300">
                        Run New Analysis
                    </button>
                </div>

            </div>
        </section>


        <!-- Luminara Glow Tips Section (Mock Content) -->
        <section id="glow-tips" class="py-20 sm:py-24">
            <div class="max-w-7xl mx-auto px-4">
                <h3 class="text-4xl font-bold text-center mb-16">
                    Luminara Glow Tips & Color Theory
                </h3>
                <div class="grid md:grid-cols-3 gap-8">
                    <!-- Tip Card 1 -->
                    <div class="bg-white p-6 rounded-xl glow-shadow border border-gray-100">
                        <img src="https://placehold.co/600x400/F9E8FF/C9A8FF?text=Color+Palette" alt="Color Palette" class="rounded-lg mb-4 w-full h-40 object-cover">
                        <h4 class="text-xl font-bold mb-2">The Power of Lilac: A Warm Tone Secret</h4>
                        <p class="text-gray-600 text-sm">Lilac and soft purples aren't just a trend—they can neutralize yellow in warm undertones, making your skin look instantly brighter.</p>
                        <a href="#" class="text-secondary font-semibold text-sm mt-3 inline-block hover:underline">Read Blog →</a>
                    </div>
                    <!-- Tip Card 2 -->
                    <div class="bg-white p-6 rounded-xl glow-shadow border border-gray-100">
                        <img src="https://placehold.co/600x400/C9A8FF/F9E8FF?text=Hydration" alt="Hydration" class="rounded-lg mb-4 w-full h-40 object-cover">
                        <h4 class="text-xl font-bold mb-2">Next-Level Hydration: The 8-Hour Rule</h4>
                        <p class="text-gray-600 text-sm">Your skin repairs itself most effectively while you sleep. Aim for 8 hours and watch your skin bounce back, regardless of your tone.</p>
                        <a href="#" class="text-secondary font-semibold text-sm mt-3 inline-block hover:underline">Read Blog →</a>
                    </div>
                    <!-- Tip Card 3 -->
                    <div class="bg-white p-6 rounded-xl glow-shadow border border-gray-100">
                        <img src="https://placehold.co/600x400/000000/F9E8FF?text=Skin+Barrier" alt="Skin Barrier" class="rounded-lg mb-4 w-full h-40 object-cover">
                        <h4 class="text-xl font-bold mb-2">Protect Your Barrier: The Ultimate Skincare Vibe</h4>
                        <p class="text-gray-600 text-sm">A strong skin barrier is key to even tone and glow. We break down the best ingredients (ceramids, niacinamide) for every skin type.</p>
                        <a href="#" class="text-secondary font-semibold text-sm mt-3 inline-block hover:underline">Read Blog →</a>
                    </div>
                </div>
            </div>
        </section>

    </main>

    <!-- Footer -->
    <footer class="bg-black text-white py-12">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="grid grid-cols-2 md:grid-cols-4 gap-8">
                <div>
                    <h5 class="text-lg font-bold mb-4">Luminara</h5>
                    <ul class="space-y-2 text-sm text-gray-400">
                        <li><a href="#" class="hover:text-secondary">About Us</a></li>
                        <li><a href="#" class="hover:text-secondary">Career (We're Hiring!)</a></li>
                        <li><a href="#" class="hover:text-secondary">Blog</a></li>
                    </ul>
                </div>
                <div>
                    <h5 class="text-lg font-bold mb-4">Support</h5>
                    <ul class="space-y-2 text-sm text-gray-400">
                        <li><a href="#" class="hover:text-secondary">Contact</a></li>
                        <li><a href="#" class="hover:text-secondary">FAQs</a></li>
                        <li><a href="#" class="hover:text-secondary">Help Center</a></li>
                    </ul>
                </div>
                <div>
                    <h5 class="text-lg font-bold mb-4">Legal</h5>
                    <ul class="space-y-2 text-sm text-gray-400">
                        <li><a href="#" class="hover:text-secondary">Privacy Policy</a></li>
                        <li><a href="#" class="hover:text-secondary">Terms of Service</a></li>
                        <li><a href="#" class="hover:text-secondary">Security</a></li>
                    </ul>
                </div>
                <div class="col-span-2 md:col-span-1">
                    <h5 class="text-lg font-bold mb-4">Stay Glowing</h5>
                    <p class="text-sm text-gray-400">Subscribe for the latest style drops and glow tips.</p>
                    <form class="mt-3 flex">
                        <input type="email" placeholder="Your email" class="p-3 w-full rounded-l-lg text-black focus:outline-none" required>
                        <button type="submit" class="bg-secondary p-3 rounded-r-lg font-bold hover:bg-opacity-80 transition">
                            →
                        </button>
                    </form>
                </div>
            </div>
            <div class="mt-12 pt-8 border-t border-gray-800 text-center text-sm text-gray-500">
                &copy; 2025 Luminara.ai. All rights reserved. Made with 💖 and AI.
            </div>
        </div>
    </footer>

    <!-- Analysis Modal (Simulates Photo Upload/Camera) -->
    <div id="analysis-modal" class="fixed inset-0 bg-black bg-opacity-70 z-50 hidden flex items-center justify-center p-4">
        <div class="bg-white p-8 rounded-2xl max-w-lg w-full glow-shadow transform transition-all duration-300">
            <div class="flex justify-between items-start mb-6">
                <h3 class="text-3xl font-extrabold text-secondary">Start Your Analysis</h3>
                <button onclick="document.getElementById('analysis-modal').classList.add('hidden')" class="text-gray-400 hover:text-gray-600 text-3xl leading-none">
                    &times;
                </button>
            </div>
            <p class="mb-6 text-gray-600">
                Luminara is ready! For this demo, please describe your skin tone and undertone below so our AI can generate your personalized report.
            </p>

            <form id="analysis-form">
                <label for="skin-description" class="block text-lg font-semibold mb-2">Describe Your Skin Tone/Undertone:</label>
                <textarea id="skin-description" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-secondary focus:border-secondary transition" rows="3" placeholder="Example: Light olive skin with neutral undertones and some redness." required></textarea>

                <div id="error-message" class="text-red-500 text-sm mt-2 hidden"></div>

                <button type="submit" id="analyze-button" class="mt-6 bg-secondary text-white w-full py-3 rounded-full text-lg font-bold hover:bg-opacity-90 transition duration-300 glow-shadow flex items-center justify-center">
                    <span id="button-text">Analyze & Glow Up!</span>
                    <svg id="loading-spinner" class="animate-spin h-5 w-5 text-white ml-3 hidden" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                        <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                    </svg>
                </button>
            </form>
        </div>
    </div>


    <script>
        // --- GEMINI API & APPLICATION LOGIC ---

        const API_URL = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`;

        const analysisForm = document.getElementById('analysis-form');
        const resultsContainer = document.getElementById('results-container');
        const analysisModal = document.getElementById('analysis-modal');
        const analyzeButton = document.getElementById('analyze-button');
        const buttonText = document.getElementById('button-text');
        const loadingSpinner = document.getElementById('loading-spinner');
        const errorMessage = document.getElementById('error-message');

        const systemPrompt = `
            Act as Luminara AI's personal stylist and dermatologist, targeting a Gen Z audience with a smart, friendly, and empowering tone.
            Your task is to provide a comprehensive, structured analysis based on the user's skin tone and undertone description.
            The response MUST be a single JSON object conforming strictly to the provided schema.

            Response Schema Details:
            - undertone: (string) Must be 'Warm', 'Cool', or 'Neutral'.
            - undertoneDescription: (string) A short explanation of the undertone.
            - skinToneCharacteristics: (string) A concise, one-paragraph explanation of the overall skin tone type.
            - colorPaletteHex: (array<string>) A list of exactly 5 HEX color codes (e.g., #FFFFFF) that perfectly compliment the skin tone (for fashion/makeup).
            - outfitSuggestion: (string) A short, Gen Z-relatable sentence describing a great outfit or style.
            - tryOnLink: (string) A mock URL to a marketplace for the suggested product (use placeholders like https://shopee.com/product-mock or https://zalora.com/product-mock).
            - skincareTips: (array<string>) 3-5 daily skin maintenance tips.
            - routineMorning: (string) A concise morning routine suggestion.
            - routineNight: (string) A concise night routine suggestion.
            - avoidFoods: (array<string>) 3-4 foods or drinks to avoid for this skin type.
            - beneficialFoods: (array<string>) 3-4 beneficial foods for glowing skin.
            - lifestyleTips: (string) A one-sentence tip on hydration and sleep.
        `;

        const responseSchema = {
            type: "OBJECT",
            properties: {
                undertone: { "type": "STRING", description: "Must be 'Warm', 'Cool', or 'Neutral'." },
                undertoneDescription: { "type": "STRING" },
                skinToneCharacteristics: { "type": "STRING" },
                colorPaletteHex: { "type": "ARRAY", items: { "type": "STRING" } },
                outfitSuggestion: { "type": "STRING" },
                tryOnLink: { "type": "STRING" },
                skincareTips: { "type": "ARRAY", items: { "type": "STRING" } },
                routineMorning: { "type": "STRING" },
                routineNight: { "type": "STRING" },
                avoidFoods: { "type": "ARRAY", items: { "type": "STRING" } },
                beneficialFoods: { "type": "ARRAY", items: { "type": "STRING" } },
                lifestyleTips: { "type": "STRING" }
            },
            propertyOrdering: [
                "undertone", "undertoneDescription", "skinToneCharacteristics", "colorPaletteHex",
                "outfitSuggestion", "tryOnLink", "skincareTips", "routineMorning", "routineNight",
                "avoidFoods", "beneficialFoods", "lifestyleTips"
            ]
        };

        const renderResults = (data) => {
            // Personal Skin Tone Analysis
            document.getElementById('r-undertone').textContent = data.undertone;
            document.getElementById('r-undertone-desc').textContent = data.undertoneDescription;
            document.getElementById('r-characteristics').textContent = data.skinToneCharacteristics;

            // Color Visualization (Tone Gradient)
            const colorPaletteEl = document.getElementById('r-color-palette');
            colorPaletteEl.innerHTML = data.colorPaletteHex.map(hex =>
                `<div style="background-color: ${hex};" class="flex-1 h-full"></div>`
            ).join('');

            // Fashion & Outfit Recommendation
            document.getElementById('r-outfit-suggestion').textContent = data.outfitSuggestion;
            document.getElementById('r-try-on-text').textContent = data.outfitSuggestion.split('. ')[0] || "that stunning look";
            document.getElementById('r-try-on-link').href = data.tryOnLink;

            const stylePaletteEl = document.getElementById('r-style-palette');
            stylePaletteEl.innerHTML = data.colorPaletteHex.map(hex =>
                `<div class="w-10 h-10 rounded-full border-2 border-gray-200 glow-shadow" style="background-color: ${hex};"></div>`
            ).join('');

            // Skincare Tips
            const skincareTipsEl = document.getElementById('r-skincare-tips');
            skincareTipsEl.innerHTML = data.skincareTips.map(tip => `<li>${tip}</li>`).join('');
            document.getElementById('r-routine-morning').textContent = data.routineMorning;
            document.getElementById('r-routine-night').textContent = data.routineNight;

            // Diet & Lifestyle
            const avoidFoodsEl = document.getElementById('r-avoid-foods');
            avoidFoodsEl.innerHTML = data.avoidFoods.map(food => `<li>${food}</li>`).join('');

            const beneficialFoodsEl = document.getElementById('r-beneficial-foods');
            beneficialFoodsEl.innerHTML = data.beneficialFoods.map(food => `<li>${food}</li>`).join('');

            document.getElementById('r-lifestyle-tips').textContent = data.lifestyleTips;

            // Show results section and scroll to it
            resultsContainer.classList.remove('hidden');
            document.getElementById('hero').scrollIntoView({ behavior: 'smooth' });
        };


        const geminiAnalyzeSkinTone = async (userDescription) => {
            const userQuery = `Analyze the following skin tone and undertone description and provide a complete structured recommendation report: "${userDescription}".`;

            const payload = {
                contents: [{ parts: [{ text: userQuery }] }],
                systemInstruction: { parts: [{ text: systemPrompt }] },
                generationConfig: {
                    responseMimeType: "application/json",
                    responseSchema: responseSchema
                }
            };

            let jsonResult = null;
            let retries = 0;
            const maxRetries = 3;

            while (retries < maxRetries) {
                try {
                    const response = await fetch(API_URL, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });

                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }

                    const result = await response.json();
                    const jsonString = result.candidates?.[0]?.content?.parts?.[0]?.text;

                    if (jsonString) {
                        // The model sometimes wraps the JSON in markdown blocks, remove them.
                        const cleanJsonString = jsonString.replace(/^```json\s*|```\s*$/g, '').trim();
                        jsonResult = JSON.parse(cleanJsonString);
                        break; // Success!
                    } else {
                        throw new Error("API response content is empty or malformed.");
                    }
                } catch (error) {
                    console.error("API call attempt failed:", error);
                    retries++;
                    if (retries < maxRetries) {
                        const delay = Math.pow(2, retries) * 1000;
                        await new Promise(resolve => setTimeout(resolve, delay));
                    } else {
                        errorMessage.textContent = "AI analysis failed after multiple retries. Please check your input or try again later.";
                        errorMessage.classList.remove('hidden');
                        return null;
                    }
                }
            }
            return jsonResult;
        };


        analysisForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const userDescription = document.getElementById('skin-description').value.trim();

            if (!userDescription) {
                errorMessage.textContent = "Please describe your skin tone to start the analysis.";
                errorMessage.classList.remove('hidden');
                return;
            }

            // UI state: Loading
            analyzeButton.disabled = true;
            buttonText.textContent = "Analyzing...";
            loadingSpinner.classList.remove('hidden');
            errorMessage.classList.add('hidden');

            const analysisData = await geminiAnalyzeSkinTone(userDescription);

            // UI state: Done
            analyzeButton.disabled = false;
            buttonText.textContent = "Analyze & Glow Up!";
            loadingSpinner.classList.add('hidden');

            if (analysisData) {
                renderResults(analysisData);
                analysisModal.classList.add('hidden');
            }
        });

    </script>
</body>
</html>
