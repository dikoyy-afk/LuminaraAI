import React, { useState, useEffect, useCallback, useMemo } from 'react';
import { Camera, Upload, CheckCircle, RotateCcw, Shirt, HeartHandshake, Utensils, Share2, Download, Menu, X } from 'lucide-react';

// --- Configuration Data ---

const SKIN_TONE_DATA = {
    Warm: {
        description: "Your skin has golden, peachy, or yellow undertones. You tan easily and usually look best in gold jewelry.",
        bestColors: ['Emerald Green', 'Olive Green', 'Coral', 'Gold', 'Cream', 'Taupe'],
        avoidColors: ['Navy Blue', 'Icy Blue', 'Fuchsia', 'Silvery Gray'],
        materials: ['Linen', 'Silk', 'Knitwear'],
        style: 'Earthy & Vibrant',
        mockHex: '#F3D2B8', // Peachy/Golden
    },
    Cool: {
        description: "Your skin has pink, red, or bluish undertones. You may burn easily and look best in silver or platinum jewelry.",
        bestColors: ['Navy Blue', 'Royal Blue', 'Deep Purple', 'True Red', 'Silver', 'White'],
        avoidColors: ['Orange', 'Rust', 'Mustard Yellow', 'Bright Gold'],
        materials: ['Denim', 'Wool', 'Satin'],
        style: 'Bold & Classic',
        mockHex: '#E5C9C9', // Pinkish/Rosy
    },
    Neutral: {
        description: "Your skin has a mix of undertones, making it versatile. You look great in both gold and silver jewelry.",
        bestColors: ['Jade Green', 'Soft Rose', 'Beige', 'Gray', 'Black', 'All pastels'],
        avoidColors: ['Very bright colors', 'Heavy earth tones'],
        materials: ['Cotton', 'Cashmere', 'Leather'],
        style: 'Minimalist & Versatile',
        mockHex: '#E8D4C8', // Balanced Beige
    },
};

const FOOD_GUIDES = {
    'To Eat Often': [
        { icon: 'ðŸŠ', item: 'Fruits rich in Vitamin C (Oranges, Berries, Kiwi)' },
        { icon: 'ðŸ¥¬', item: 'Dark Green Vegetables (Spinach, Kale)' },
        { icon: 'ðŸŒ°', item: 'Antioxidant-rich foods (Nuts, Seeds, Dark Chocolate)' },
        { icon: 'ðŸŸ', item: 'Omega-3 rich foods (Salmon, Walnuts)' },
        { icon: 'ðŸ¥›', item: 'Hydrating drinks (Water, Herbal Tea)' },
    ],
    'To Avoid': [
        { icon: 'ðŸŸ', item: 'Fried and Greasy Foods' },
        { icon: 'ðŸ©', item: 'High-Sugar Drinks and Processed Snacks' },
        { icon: 'ðŸž', item: 'Refined Carbohydrates (White Bread, Pasta)' },
        { icon: 'â˜•', item: 'Excessive Caffeine or Alcohol' },
    ],
};

const ROUTINE_TIPS = [
    { title: "Gentle Cleansing", tip: "Wash twice daily with a pH-balanced cleanser to remove impurities without stripping natural oils." },
    { title: "Hydration is Key", tip: "Apply a hyaluronic acid serum and a non-comedogenic moisturizer immediately after cleansing." },
    { title: "Sun Protection", tip: "Never skip SPF 30+ every morning, even on cloudy days or indoors." },
    { title: "Night Repair", tip: "Incorporate retinoids (if tolerated) or gentle exfoliants 2-3 times a week to promote cell turnover." },
];

// --- Utility Components ---

const Button = ({ children, onClick, className = '' }) => (
    <button
        onClick={onClick}
        className={`w-full md:w-auto px-6 py-3 font-semibold text-white transition duration-300 ease-in-out transform rounded-xl shadow-lg hover:shadow-xl active:scale-95 ${className}`}
    >
        {children}
    </button>
);

const Card = ({ children, className = '' }) => (
    <div className={`p-6 bg-white rounded-2xl shadow-lg border border-gray-100 transition duration-300 hover:shadow-xl ${className}`}>
        {children}
    </div>
);

const ColorSwatch = ({ hex, label, className = '' }) => (
    <div className={`flex flex-col items-center p-2 rounded-xl transition duration-300 ${className}`}>
        <div
            className="w-10 h-10 rounded-full shadow-md border border-gray-200"
            style={{ backgroundColor: hex }}
        ></div>
        <span className="mt-2 text-xs font-medium text-gray-700">{label}</span>
    </div>
);

const FeatureSection = ({ title, icon: Icon, children }) => (
    <div className="mb-8">
        <h2 className="flex items-center text-2xl font-bold text-pink-700 mb-4">
            <Icon className="w-6 h-6 mr-3 text-pink-400" />
            {title}
        </h2>
        {children}
    </div>
);

// --- Navigation & Header ---

const navItems = [
    { id: 'home', label: 'Home' },
    { id: 'analyzer', label: 'Analyzer', icon: Camera },
    { id: 'outfit', label: 'Outfit Match', icon: Shirt },
    { id: 'skincare', label: 'Skincare Tips', icon: HeartHandshake },
];

const Header = ({ setPage, currentPage, resetAnalysis }) => {
    const [isMenuOpen, setIsMenuOpen] = useState(false);

    const handleNavClick = (pageId) => {
        setPage(pageId);
        setIsMenuOpen(false);
        if (pageId === 'analyzer') {
            resetAnalysis();
        }
    };

    return (
        <header className="fixed top-0 left-0 right-0 z-50 bg-white/90 backdrop-blur-sm shadow-sm">
            <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4 flex justify-between items-center">
                <button onClick={() => handleNavClick('home')} className="flex items-center text-2xl font-extrabold text-pink-600 tracking-wider">
                    Luminara
                </button>

                <nav className="hidden md:flex space-x-6">
                    {navItems.map(item => (
                        <button
                            key={item.id}
                            onClick={() => handleNavClick(item.id)}
                            className={`flex items-center px-3 py-1.5 text-sm font-medium transition duration-200 rounded-lg ${
                                currentPage === item.id ? 'text-pink-600 bg-pink-50' : 'text-gray-600 hover:text-pink-600 hover:bg-pink-50'
                            }`}
                        >
                            {item.icon && <item.icon className="w-4 h-4 mr-1" />}
                            {item.label}
                        </button>
                    ))}
                </nav>

                {/* Mobile Menu Button */}
                <button className="md:hidden p-2 text-gray-600 hover:text-pink-600" onClick={() => setIsMenuOpen(!isMenuOpen)}>
                    {isMenuOpen ? <X className="w-6 h-6" /> : <Menu className="w-6 h-6" />}
                </button>
            </div>

            {/* Mobile Menu */}
            {isMenuOpen && (
                <div className="md:hidden absolute top-full left-0 right-0 bg-white shadow-xl border-t border-gray-100">
                    {navItems.map(item => (
                        <button
                            key={item.id}
                            onClick={() => handleNavClick(item.id)}
                            className={`w-full text-left flex items-center px-6 py-3 text-base font-medium transition duration-200 ${
                                currentPage === item.id ? 'text-pink-700 bg-pink-100' : 'text-gray-700 hover:text-pink-700 hover:bg-pink-50'
                            }`}
                        >
                            {item.icon && <item.icon className="w-5 h-5 mr-3" />}
                            {item.label}
                        </button>
                    ))}
                </div>
            )}
        </header>
    );
};

// --- Page Components ---

const HomePage = ({ setPage }) => (
    <div className="min-h-screen pt-24 pb-12 flex flex-col items-center justify-center text-center bg-gray-50">
        <div className="max-w-3xl px-6">
            <h1 className="text-5xl md:text-6xl font-extrabold text-gray-900 leading-tight mb-4">
                Unlock Your Personal <span className="text-pink-600">Color DNA</span>.
            </h1>
            <p className="text-xl text-gray-600 mb-10">
                Luminara uses cutting-edge vision technology to analyze your unique skin tone and undertone, providing personalized insights for fashion and skincare.
            </p>
            <Button
                onClick={() => setPage('analyzer')}
                className="bg-pink-600 hover:bg-pink-700"
            >
                <div className="flex items-center justify-center">
                    <Camera className="w-5 h-5 mr-2" />
                    Start Analysis Now
                </div>
            </Button>
            <div className="mt-12 grid grid-cols-1 md:grid-cols-3 gap-8 text-left">
                <Card>
                    <Shirt className="w-8 h-8 text-pink-500 mb-3" />
                    <h3 className="text-lg font-semibold text-gray-800">Perfect Outfits</h3>
                    <p className="text-sm text-gray-500 mt-1">Discover colors that make your skin glow and define your style.</p>
                </Card>
                <Card>
                    <HeartHandshake className="w-8 h-8 text-pink-500 mb-3" />
                    <h3 className="text-lg font-semibold text-gray-800">Skincare Insights</h3>
                    <p className="text-sm text-gray-500 mt-1">Get custom routines and nutrition advice tailored to your skinâ€™s needs.</p>
                </Card>
                <Card>
                    <CheckCircle className="w-8 h-8 text-pink-500 mb-3" />
                    <h3 className="text-lg font-semibold text-gray-800">Accurate Results</h3>
                    <p className="text-sm text-gray-500 mt-1">Detailed HEX/RGB reports for makeup and foundation matching.</p>
                </Card>
            </div>
        </div>
    </div>
);

const AIAnalyzer = ({ setPage, setReport, setIsAnalyzing }) => {
    const [file, setFile] = useState(null);
    const [previewUrl, setPreviewUrl] = useState('');
    const [error, setError] = useState('');
    const [isCameraActive, setIsCameraActive] = useState(false);

    // Placeholder for video stream (real implementation requires getUserMedia and canvas analysis)
    const videoRef = React.useRef(null);

    // Simulate AI analysis and result generation
    const runAnalysis = useCallback(() => {
        if (!file && !isCameraActive) {
            setError('Please upload a photo or activate the camera first.');
            return;
        }

        setError('');
        setIsAnalyzing(true);

        // Simulated delay for "AI processing"
        setTimeout(() => {
            const undertones = ['Warm', 'Cool', 'Neutral'];
            const randomUndertone = undertones[Math.floor(Math.random() * undertones.length)];
            const data = SKIN_TONE_DATA[randomUndertone];
            const rgb = [
                parseInt(data.mockHex.substring(1, 3), 16),
                parseInt(data.mockHex.substring(3, 5), 16),
                parseInt(data.mockHex.substring(5, 7), 16)
            ];

            const analysisReport = {
                undertone: randomUndertone,
                colorHex: data.mockHex,
                colorRgb: `rgb(${rgb.join(', ')})`,
                reportId: crypto.randomUUID(),
                timestamp: new Date().toLocaleDateString(),
            };

            setReport(analysisReport);
            setIsAnalyzing(false);
            setPage('report');

        }, 2500); // 2.5 second analysis delay
    }, [file, isCameraActive, setReport, setIsAnalyzing, setPage]);

    const handleFileChange = (e) => {
        const selectedFile = e.target.files[0];
        if (selectedFile) {
            setFile(selectedFile);
            setPreviewUrl(URL.createObjectURL(selectedFile));
            setIsCameraActive(false); // Stop camera if file is uploaded
            if (videoRef.current && videoRef.current.srcObject) {
                videoRef.current.srcObject.getTracks().forEach(track => track.stop());
            }
            setError('');
        }
    };

    // Camera simulation setup (visual only, no real stream)
    const toggleCamera = () => {
        setIsCameraActive(!isCameraActive);
        setFile(null);
        setPreviewUrl('');
        setError('');
        if (videoRef.current && videoRef.current.srcObject) {
             videoRef.current.srcObject.getTracks().forEach(track => track.stop());
        }
    };

    return (
        <div className="max-w-4xl mx-auto py-24 px-6 min-h-screen">
            <FeatureSection title="AI Skin Tone Analyzer" icon={Camera}>
                <p className="text-gray-600 mb-6">Capture your face clearly for the most accurate results. Ensure good, natural lighting.</p>

                <Card className="p-4 md:p-8 space-y-4 text-center">
                    {/* Camera / Upload Preview Area */}
                    <div className="w-full h-80 bg-gray-100 rounded-xl overflow-hidden flex items-center justify-center border-2 border-dashed border-pink-300">
                        {previewUrl ? (
                            <img src={previewUrl} alt="Uploaded skin tone preview" className="object-cover w-full h-full" />
                        ) : isCameraActive ? (
                            <div className="flex flex-col items-center justify-center w-full h-full bg-pink-50">
                                <video ref={videoRef} className="w-full h-full object-cover" autoPlay muted playsInline>
                                    {/* Placeholder for camera feed - cannot run live getUserMedia in this sandbox */}
                                </video>
                                <span className="absolute text-pink-700 text-lg font-medium">Camera Feed Active (Simulated)</span>
                            </div>
                        ) : (
                            <div className="flex flex-col items-center">
                                <Upload className="w-10 h-10 text-pink-400 mb-2" />
                                <p className="text-gray-500">Upload a photo or use your device camera.</p>
                            </div>
                        )}
                    </div>

                    {/* Controls */}
                    <div className="flex flex-col md:flex-row gap-4 pt-2">
                        <label className="flex-1">
                            <input
                                type="file"
                                accept="image/*"
                                className="hidden"
                                onChange={handleFileChange}
                            />
                            <Button className="w-full bg-gray-500 hover:bg-gray-600 flex items-center justify-center">
                                <Upload className="w-5 h-5 mr-2" />
                                Upload Photo
                            </Button>
                        </label>
                        <Button onClick={toggleCamera} className={`flex-1 flex items-center justify-center transition ${isCameraActive ? 'bg-red-500 hover:bg-red-600' : 'bg-pink-500 hover:bg-pink-600'}`}>
                            <Camera className="w-5 h-5 mr-2" />
                            {isCameraActive ? 'Stop Camera' : 'Use Camera'}
                        </Button>
                    </div>
                    {error && <p className="text-red-500 mt-3">{error}</p>}
                    <div className="pt-4">
                        <Button
                            onClick={runAnalysis}
                            disabled={(!file && !isCameraActive) || error}
                            className="bg-pink-600 hover:bg-pink-700 disabled:opacity-50 disabled:cursor-not-allowed"
                        >
                            <div className="flex items-center justify-center">
                                <CheckCircle className="w-5 h-5 mr-2" />
                                Run Skin Analysis
                            </div>
                        </Button>
                    </div>
                </Card>
            </FeatureSection>
        </div>
    );
};

const ReportPage = ({ report, setPage, resetAnalysis }) => {
    const data = SKIN_TONE_DATA[report.undertone];

    const handleShare = () => {
        // Mock sharing functionality
        const shareText = `Check out my Luminara report! My undertone is ${report.undertone} and my perfect color is ${report.colorHex}. Find your match today at Luminara!`;
        if (navigator.share) {
            navigator.share({
                title: 'Luminara Skin Report',
                text: shareText,
            });
        } else {
            // Fallback for desktop/non-share supporting browsers
            navigator.clipboard.writeText(shareText);
            console.log('Share text copied to clipboard:', shareText);
            alert("Report details copied to clipboard!"); // Use alert() here as a controlled message box replacement
        }
    };

    const handleDownload = () => {
        // Mock download functionality - creating a simple text file
        const content = `Luminara Skin Report\n\n- Undertone: ${report.undertone}\n- Primary Color (HEX): ${report.colorHex}\n- Primary Color (RGB): ${report.colorRgb}\n- Best Style: ${data.style}\n- Report ID: ${report.reportId}\n- Date: ${report.timestamp}`;
        const blob = new Blob([content], { type: 'text/plain;charset=utf-8' });
        const url = URL.createObjectURL(blob);
        const link = document.createElement('a');
        link.href = url;
        link.download = `Luminara_Report_${report.reportId}.txt`;
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
        alert("Report downloaded!"); // Use alert() here as a controlled message box replacement
    };

    return (
        <div className="max-w-4xl mx-auto py-24 px-6 min-h-screen">
            <FeatureSection title="Your Personal Skin Tone Report" icon={CheckCircle}>
                <Card className="p-8 text-center bg-pink-50 border-pink-200">
                    <div className="flex flex-col items-center">
                        <div
                            className={`w-24 h-24 rounded-full shadow-2xl transition duration-500 ease-in-out transform scale-110 border-4 border-white mb-4`}
                            style={{ backgroundColor: report.colorHex }}
                        ></div>
                        <h3 className={`text-4xl font-extrabold mb-2 ${report.undertone === 'Warm' ? 'text-amber-700' : report.undertone === 'Cool' ? 'text-blue-700' : 'text-stone-700'}`}>
                            {report.undertone} Undertone
                        </h3>
                        <p className="text-xl text-gray-700 mb-6">{data.description}</p>

                        <div className="grid grid-cols-2 gap-4 w-full max-w-sm mx-auto text-left">
                            <div className="bg-white p-3 rounded-lg shadow-inner">
                                <p className="text-xs font-semibold text-gray-500">HEX</p>
                                <p className="text-lg font-mono text-gray-800">{report.colorHex}</p>
                            </div>
                            <div className="bg-white p-3 rounded-lg shadow-inner">
                                <p className="text-xs font-semibold text-gray-500">RGB</p>
                                <p className="text-lg font-mono text-gray-800">{report.colorRgb.replace(/[rgb()]/g, '')}</p>
                            </div>
                        </div>

                        <div className="mt-8 flex flex-col sm:flex-row gap-3 w-full max-w-md">
                            <Button onClick={() => setPage('outfit')} className="flex-1 bg-pink-600 hover:bg-pink-700 text-sm">
                                Go to Outfit Matches
                            </Button>
                            <Button onClick={() => setPage('skincare')} className="flex-1 bg-teal-500 hover:bg-teal-600 text-sm">
                                Skincare Insights
                            </Button>
                        </div>
                        <div className="mt-4 flex gap-3 w-full max-w-md">
                            <Button onClick={handleShare} className="flex-1 bg-gray-500 hover:bg-gray-600 text-sm flex items-center justify-center">
                                <Share2 className="w-4 h-4 mr-1" /> Share
                            </Button>
                            <Button onClick={handleDownload} className="flex-1 bg-gray-500 hover:bg-gray-600 text-sm flex items-center justify-center">
                                <Download className="w-4 h-4 mr-1" /> Download
                            </Button>
                        </div>
                        <button
                            onClick={resetAnalysis}
                            className="mt-6 text-sm text-gray-500 hover:text-pink-600 transition flex items-center"
                        >
                            <RotateCcw className="w-4 h-4 mr-1" /> Run New Analysis
                        </button>
                    </div>
                </Card>
            </FeatureSection>
        </div>
    );
};

const OutfitMatch = ({ report }) => {
    const data = SKIN_TONE_DATA[report.undertone];
    const mockImagePlaceholder = `https://placehold.co/400x500/F472B6/ffffff?text=${data.style}+Outfits`;
    const mockStoreLink = "#"; // Mock link

    return (
        <div className="max-w-4xl mx-auto py-24 px-6 min-h-screen">
            <FeatureSection title={`Outfit Matches for ${report.undertone} Undertone`} icon={Shirt}>
                <p className="text-gray-600 mb-6">These are the colors and styles that naturally enhance your skin tone and make you glow.</p>

                <div className="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                    {/* Style Card */}
                    <Card className="md:col-span-1 bg-pink-50 text-center">
                        <h3 className="text-xl font-bold text-pink-700 mb-2">Recommended Style</h3>
                        <p className="text-3xl font-extrabold text-gray-900">{data.style}</p>
                        <p className="text-sm text-gray-500 mt-2">Best material: <span className="font-semibold">{data.materials.join(', ')}</span></p>
                    </Card>

                    {/* Best Colors */}
                    <Card className="md:col-span-2">
                        <h3 className="text-xl font-bold text-gray-800 mb-4">Your Best Color Palette</h3>
                        <div className="flex flex-wrap gap-4 justify-center md:justify-start">
                            {data.bestColors.map((color, index) => (
                                <ColorSwatch key={index} hex={color.replace(/ /g, '')} label={color} className="shadow-inner" />
                            ))}
                        </div>
                    </Card>
                </div>

                <Card>
                    <h3 className="text-xl font-bold text-gray-800 mb-4">Visual Example & Shopping</h3>
                    <div className="flex flex-col md:flex-row gap-6">
                        <div className="md:w-1/2">
                            <img
                                src={mockImagePlaceholder}
                                alt="Recommended outfit example"
                                className="w-full h-auto rounded-xl shadow-lg object-cover"
                                onError={(e) => { e.target.onerror = null; e.target.src="https://placehold.co/400x500/D2B48C/000000?text=Style+Example" }}
                            />
                        </div>
                        <div className="md:w-1/2 flex flex-col justify-between">
                            <div>
                                <h4 className="text-lg font-semibold text-gray-800 mb-2">Example Outfit Description</h4>
                                <p className="text-gray-600 mb-4">A simple yet elegant look featuring an outfit in your recommended color palette.</p>
                                <div className="space-y-2">
                                    <p className="text-sm"><span className="font-semibold">Color Focus:</span> {data.bestColors[0]} and {data.bestColors[1]}</p>
                                    <p className="text-sm"><span className="font-semibold">Material:</span> {data.materials[0]}</p>
                                    <p className="text-sm"><span className="font-semibold">Colors to AVOID:</span> {data.avoidColors.join(', ')}</p>
                                </div>
                            </div>
                            <a href={mockStoreLink} target="_blank" rel="noopener noreferrer">
                                <Button className="w-full mt-4 bg-purple-600 hover:bg-purple-700">
                                    <div className="flex items-center justify-center">
                                        Shop Now (Tokopedia/Zalora Mock)
                                    </div>
                                </Button>
                            </a>
                        </div>
                    </div>
                </Card>
            </FeatureSection>
        </div>
    );
};

const SkincareTips = ({ report }) => {
    const data = SKIN_TONE_DATA[report.undertone];

    return (
        <div className="max-w-4xl mx-auto py-24 px-6 min-h-screen">
            <FeatureSection title="Personalized Skincare & Nutrition" icon={HeartHandshake}>
                <p className="text-gray-600 mb-6">Caring for your skin starts from within. Here are tips tailored to your color DNA.</p>

                {/* Skincare Routine */}
                <Card className="mb-8">
                    <h3 className="text-xl font-bold text-pink-700 mb-4">Daily Skincare Routine</h3>
                    <div className="grid grid-cols-1 sm:grid-cols-2 gap-4">
                        {ROUTINE_TIPS.map((item, index) => (
                            <div key={index} className="p-4 bg-pink-50 rounded-lg border border-pink-100">
                                <h4 className="font-semibold text-gray-800 flex items-center">
                                    <span className="text-pink-500 mr-2 text-lg">{index + 1}.</span> {item.title}
                                </h4>
                                <p className="text-sm text-gray-600 mt-1">{item.tip}</p>
                            </div>
                        ))}
                    </div>
                </Card>

                {/* Brightening & Tone */}
                <Card className="mb-8">
                    <h3 className="text-xl font-bold text-pink-700 mb-4">Tone Brightening & Evening Insights</h3>
                    <div className="space-y-3 text-gray-700">
                        <p className="font-semibold">For your {report.undertone} skin tone:</p>
                        <ul className="list-disc list-inside space-y-2 text-sm ml-4">
                            <li>Focus on ingredients like <span className="font-medium text-pink-600">Niacinamide</span> and <span className="font-medium text-pink-600">Vitamin C</span> to gently enhance natural radiance.</li>
                            <li>Use <span className="font-medium">Licorice Root</span> or <span className="font-medium">Kojic Acid</span> if you experience minor hyperpigmentation.</li>
                            <li>Maintain a strong skin barrier with ceramides to prevent redness or dullness, common issues for various undertones.</li>
                        </ul>
                    </div>
                </Card>

                {/* Nutrition Guide */}
                <Card>
                    <h3 className="text-xl font-bold text-pink-700 mb-4 flex items-center">
                        <Utensils className="w-5 h-5 mr-2 text-pink-400" /> Nutrition Guide for Glowing Skin
                    </h3>
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                        {Object.entries(FOOD_GUIDES).map(([category, items]) => (
                            <div key={category}>
                                <h4 className={`text-lg font-semibold mb-3 ${category === 'To Eat Often' ? 'text-teal-600' : 'text-red-600'}`}>
                                    {category}
                                </h4>
                                <ul className="space-y-2">
                                    {items.map((food, index) => (
                                        <li key={index} className="flex items-start text-gray-700 text-sm">
                                            <span className="mr-2 text-lg flex-shrink-0">{food.icon}</span>
                                            {food.item}
                                        </li>
                                    ))}
                                </ul>
                            </div>
                        ))}
                    </div>
                </Card>
            </FeatureSection>
        </div>
    );
};

// --- Main App Component ---

export default function App() {
    const [page, setPage] = useState('home');
    const [isAnalyzing, setIsAnalyzing] = useState(false);
    const [report, setReport] = useState(null); // Stores the analysis result

    // Reset function to clear results and go back to analyzer
    const resetAnalysis = useCallback(() => {
        setReport(null);
        setPage('analyzer');
    }, []);

    // Effect to handle scrolling to top on page change
    useEffect(() => {
        window.scrollTo(0, 0);
    }, [page]);

    const renderContent = useMemo(() => {
        if (isAnalyzing) {
            return (
                <div className="min-h-screen flex flex-col items-center justify-center pt-24 bg-gray-50 p-6">
                    <div className="animate-spin rounded-full h-16 w-16 border-t-4 border-b-4 border-pink-500 mb-4"></div>
                    <h2 className="text-xl font-semibold text-gray-700">Analyzing Your Color DNA...</h2>
                    <p className="text-gray-500 mt-2">This may take a moment. Please wait for your personalized report.</p>
                </div>
            );
        }

        if (page === 'report' && report) {
            return <ReportPage report={report} setPage={setPage} resetAnalysis={resetAnalysis} />;
        }

        switch (page) {
            case 'analyzer':
                return <AIAnalyzer setPage={setPage} setReport={setReport} setIsAnalyzing={setIsAnalyzing} />;
            case 'outfit':
                return report ? <OutfitMatch report={report} /> : <div className="text-center py-40">Please run an analysis first. <Button onClick={() => setPage('analyzer')} className="bg-pink-600">Start Analysis</Button></div>;
            case 'skincare':
                return report ? <SkincareTips report={report} /> : <div className="text-center py-40">Please run an analysis first. <Button onClick={() => setPage('analyzer')} className="bg-pink-600">Start Analysis</Button></div>;
            case 'home':
            default:
                return <HomePage setPage={setPage} />;
        }
    }, [page, isAnalyzing, report, resetAnalysis, setPage, setReport, setIsAnalyzing]);

    return (
        <div className="min-h-screen bg-gray-50 font-[Poppins]">
            {/* FIX: Removed non-standard 'jsx' and 'global' attributes which caused the React warnings. */}
            <style>
                {`
                /* Font import for a clean, modern look */
                @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700;800&display=swap');
                body {
                    font-family: 'Poppins', sans-serif;
                    background-color: #f9fafb; /* Light gray-50 */
                }
                `}
            </style>
            <Header setPage={setPage} currentPage={page} resetAnalysis={resetAnalysis} />
            <main className="pt-16">
                {renderContent}
            </main>
            {/* Footer - Minimalist */}
            <footer className="w-full border-t border-gray-100 py-6 text-center text-gray-500 text-sm bg-white">
                &copy; {new Date().getFullYear()} Luminara. Personalized Beauty Powered by Color.
            </footer>
        </div>
    );
}
